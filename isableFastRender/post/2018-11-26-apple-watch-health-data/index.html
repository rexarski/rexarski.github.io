<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?port=1313&mindelay=10&v=2" data-no-instant defer></script>
    
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta name="HandheldFriendly" content="True" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<meta name="generator" content="Hugo 0.74.3" />



<link rel="apple-touch-icon" sizes="180x180" href="https://cdn.jsdelivr.net/gh/amzrk2/cdn-stcapi@1/favicons/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="https://cdn.jsdelivr.net/gh/amzrk2/cdn-stcapi@1/favicons/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="https://cdn.jsdelivr.net/gh/amzrk2/cdn-stcapi@1/favicons/favicon-16x16.png" />
<link rel="manifest" href="https://cdn.jsdelivr.net/gh/amzrk2/cdn-stcapi@1/favicons/site.webmanifest" />
<link rel="mask-icon" href="https://cdn.jsdelivr.net/gh/amzrk2/cdn-stcapi@1/favicons/safari-pinned-tab.svg" color="#8aa2d3" />
<link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/amzrk2/cdn-stcapi@1/favicons/favicon.ico" />
<meta name="theme-color" content="#ffffff" />


<title>A Sneak Peek at Apple Watch Health Data - @qrui - interetro.xyz</title>


<meta name="author" content="Qiū Ruì" />


<meta name="description" content="A minimal Hugo theme with nice theme color." />


<meta name="keywords" content="iOS, ggplot2, Visualization" />

<meta property="og:title" content="A Sneak Peek at Apple Watch Health Data" />
<meta property="og:description" content="I&rsquo;ve always been wondering if Apple could utilize its collected health data in a more elegant way. The Activity app is decent, especially the achievements inside are definitely highlights in an iPhone x Apple Watch dynamic duo." />
<meta property="og:type" content="article" />
<meta property="og:url" content="//localhost:1313/post/2018-11-26-apple-watch-health-data/" />
<meta property="og:image" content="//localhost:1313/img/og.png"/>
<meta property="article:published_time" content="2018-11-26T23:17:51+10:00" />
<meta property="article:modified_time" content="2018-11-26T23:17:51+10:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="//localhost:1313/img/og.png"/>

<meta name="twitter:title" content="A Sneak Peek at Apple Watch Health Data"/>
<meta name="twitter:description" content="I&rsquo;ve always been wondering if Apple could utilize its collected health data in a more elegant way. The Activity app is decent, especially the achievements inside are definitely highlights in an iPhone x Apple Watch dynamic duo."/>




<link rel="stylesheet" href="/assets/css/fuji.min.css" />






</head>

<body data-theme="auto">
    <script data-cfasync="false">
  
  var fujiThemeData = localStorage.getItem('fuji_data-theme');
  
  if (!fujiThemeData) {
    localStorage.setItem('fuji_data-theme', 'auto');
  } else {
    
    if (fujiThemeData !== 'auto') {
      document.body.setAttribute('data-theme', fujiThemeData === 'dark' ? 'dark' : 'light');
    }
  }
</script>

    <header>
    <div class="container-lg clearfix">
        <div class="col-12 header">
            <a class="title-main" href="//localhost:1313/">@qrui - interetro.xyz</a>
            
            <span class="title-sub">Half data viz tinkering, half chaos.</span>
            
        </div>
    </div>
</header>

    <main>
        <div class="container-lg clearfix">
            
            <div class="col-12 col-md-9 float-left content">
                
<article>
    
    <h2 class="post-item post-title">
        <a href="//localhost:1313/post/2018-11-26-apple-watch-health-data/">A Sneak Peek at Apple Watch Health Data</a>
    </h2>
    <div class="post-item post-meta">
        <span><i class="iconfont icon-today-sharp"></i>&nbsp;2018-11-26</span><span><i class="iconfont icon-file-tray-sharp"></i>&nbsp;1273 words</span><span><i class="iconfont icon-pricetags-sharp"></i>&nbsp;<a href="/tags/ios">iOS</a>&nbsp;<a href="/tags/ggplot2">ggplot2</a>&nbsp;<a href="/tags/visualization">Visualization</a>&nbsp;</span>

    </div>
    
    
    <div class="post-content markdown-body">
        <p>I&rsquo;ve always been wondering if Apple could utilize its collected health data in a more elegant way. The Activity app is decent, especially the achievements inside are definitely highlights in an <em>iPhone x Apple Watch</em> dynamic duo. On the other hand, the Health app serves nothing but a centralized information hub for various types data collected by either the sensor in your iPhone or your Apple Watch.</p>
<p>Well, that&rsquo;s basically my perspective and I don&rsquo;t have any constructive suggestions yet. But one thing that always interests me is that if I can play some magic around those hidden data. The answer is an absolute yes. The data export from iPhone is quite easy, and kudos to Apple. The problem is, the data comes in JSON format. <a href="http://www.ryanpraski.com/apple-health-data-how-to-export-analyze-visualize-guide/#2" target="_blank">Ryan Praskievicz</a> provided a Python script to convert those extracted JSON to csv, but also he attached a link to an online converter <a href="http://ericwolter.com/projects/health-export.html" target="_blank">here</a>.</p>
<p><img class="special-img-class" style="width:100%" src="/image/apple-health-to-csv.png" /></p>
<p><img class="img-zoomable" src="/%22/image/apple-health-to-csv.png" alt="" />
</p>
<p>I initially had the very first model of Apple Watch, aka the &ldquo;Apple Watch before Series 1&rdquo;, aka &ldquo;Series 0&rdquo;, which should be considered as a crappy smart watch even back in a scenario 4 years ago. The battery life could hardly power through one day, and launching a third-party app could literally take half a minute. So the only two functions I used were time keeping and activaity monitoring. Unfortunately, the watch encountered a serious this May and I still haven&rsquo;t figured out what happened to it. But in short, the watch stopped syncing with my iPhone and did not track any movements either. I had to perform a hard reset and thus lost all data prior to that day. So far, the data sitting on my MacBook is my Apple Watch health data collected from early this May to October.</p>
<p>The size of the data is around 90 mb and it wouldn&rsquo;t take too long to convert them to csv. But this really depends. I mean if you have a load of several years&rsquo; data, I strongly suggest you make yourself a cup of tea during this time. I haven&rsquo;t checked the data structure inside at that moment, but a vague goal is to mimic the &ldquo;major three&rdquo; on Apple Watch: the activities, the exercise time and the standing hours. Surprisingly, the exported data has no standing hours, so that I have to use daily steps as a substitute.</p>
<pre><code class="language-r">library(tidyverse)
library(lubridate)
library(gridExtra)
library(RColorBrewer)

read_one_field &lt;- function(filename) {
    file &lt;- read_delim(paste0(&quot;./&quot;, filename), delim=&quot;;&quot;, na = c(&quot;&quot;, &quot;NA&quot;))
    # glimpse(file)

    if (str_detect(file$type[1],
                   regex(&quot;ActiveEnergyBurned&quot;, ignore_case = TRUE))) {
        core_data &lt;- file %&gt;%
            select(creationDate, value) %&gt;%  # unit: kcal
            mutate(creationDate = as_datetime(creationDate)) %&gt;%
            rename(active = value) %&gt;%
            group_by(day = date(creationDate)) %&gt;%
            summarise(active = sum(active))
    } else if (str_detect(file$type[1],
                          regex(&quot;AppleExerciseTime&quot;, ignore_case = TRUE))) {
        core_data &lt;- file %&gt;%
            select(creationDate, value) %&gt;%  # unit: min
            mutate(creationDate = as_datetime(creationDate)) %&gt;%
            rename(exercise = value) %&gt;%
            group_by(day = date(creationDate)) %&gt;%
            summarise(exercise = sum(exercise))
    } else if (str_detect(file$type[1],
                          regex(&quot;StepCount&quot;, ignore_case = TRUE))) {
        core_data &lt;- file %&gt;%
            select(creationDate, value) %&gt;%  # unit: count
            mutate(creationDate = as_datetime(creationDate)) %&gt;%
            rename(step = value) %&gt;%
            group_by(day = date(creationDate)) %&gt;%
            summarise(step = sum(step))
    }

}

active &lt;- read_one_field(&quot;/data/apple_health_export/HKQuantityTypeIdentifierActiveEnergyBurned.csv&quot;)
exercise &lt;- read_one_field(&quot;/data/apple_health_export/HKQuantityTypeIdentifierAppleExerciseTime.csv&quot;)
step &lt;- read_one_field(&quot;/data/apple_health_export/HKQuantityTypeIdentifierStepCount.csv&quot;)
</code></pre>
<p>The csv files are pretty neat overall, only a few NAs to deal with. Afterwards, I notice that each entry is responsible for an time elapse ranging from several seconds to minutes. Hence aggregation is unavoidable. The most natural way to do so is to group them by days.</p>
<pre><code class="language-r"># standard: active = 400, exercise = 30, step = 10000

full_data &lt;- active %&gt;%
    full_join(exercise) %&gt;%
    full_join(step) %&gt;%
    replace_na(list(active = 0, exercise = 0, step = 0)) %&gt;%
    mutate(active = active / 400,
           exercise = exercise / 30,
           step = step / 10000) %&gt;%
    gather(key = type, value = value, -day)
</code></pre>
<p>Soon I come up with a line plot using a cutomized theme, which seems pretty similar to Apple&rsquo;s Activity color palette. The theme is based on a pure black <code>ggplot2</code> theme on <a href="https://gist.github.com/jslefche/eff85ef06b4705e6efbc" target="_blank">GitHub</a>.</p>
<pre><code class="language-r">theme_black = function(base_size = 12, base_family = &quot;&quot;) {

    theme_grey(base_size = base_size, base_family = base_family) %+replace%

        theme(
            # Specify axis options
            axis.line = element_blank(),
            axis.text.x = element_text(size = base_size*0.8, color = &quot;white&quot;, lineheight = 0.9),
            axis.text.y = element_text(size = base_size*0.8, color = &quot;white&quot;, lineheight = 0.9),
            axis.ticks = element_line(color = &quot;white&quot;, size  =  0.2),
            axis.title.x = element_text(size = base_size, color = &quot;white&quot;, margin = margin(0, 10, 0, 0)),
            axis.title.y = element_text(size = base_size, color = &quot;white&quot;, angle = 90, margin = margin(0, 10, 0, 0)),
            axis.ticks.length = unit(0.3, &quot;lines&quot;),
            # Specify legend options
            legend.background = element_rect(color = NA, fill = &quot;black&quot;),
            legend.key = element_rect(color = &quot;white&quot;,  fill = &quot;black&quot;),
            legend.key.size = unit(1.2, &quot;lines&quot;),
            legend.key.height = NULL,
            legend.key.width = NULL,
            legend.text = element_text(size = base_size*0.8, color = &quot;white&quot;),
            legend.title = element_text(size = base_size*0.8, face = &quot;bold&quot;, hjust = 0, color = &quot;white&quot;),
            legend.position = &quot;right&quot;,
            legend.text.align = NULL,
            legend.title.align = NULL,
            legend.direction = &quot;vertical&quot;,
            legend.box = NULL,
            # Specify panel options
            panel.background = element_rect(fill = &quot;black&quot;, color  =  NA),
            panel.border = element_rect(fill = NA, color = &quot;white&quot;),
            panel.grid.major = element_line(color = &quot;grey35&quot;),
            panel.grid.minor = element_line(color = &quot;grey20&quot;),
            panel.margin = unit(0.5, &quot;lines&quot;),
            # Specify facetting options
            strip.background = element_rect(fill = &quot;grey30&quot;, color = &quot;grey10&quot;),
            strip.text.x = element_text(size = base_size*0.8, color = &quot;white&quot;),
            strip.text.y = element_text(size = base_size*0.8, color = &quot;white&quot;,angle = -90),
            # Specify plot options
            plot.background = element_rect(color = &quot;black&quot;, fill = &quot;black&quot;),
            plot.title = element_text(size = base_size*1.2, color = &quot;white&quot;),
            plot.margin = unit(c(0.35, 0.2, 0.3, 0.35), &quot;cm&quot;)
        )
}
</code></pre>
<pre><code class="language-r">ggplot(full_data, aes(x=day, y=value)) +
    geom_line(aes(color=type),size=1) +
    scale_color_manual(labels = c(&quot;Active Energy&quot;, &quot;Exercise Time&quot;, &quot;Steps&quot;),
                       values=c(&quot;#FF0054&quot;, &quot;#8CFF00&quot;, &quot;#00FFCA&quot;)) +
    theme_black() +
    facet_grid(type ~ .) +
    labs(title=&quot;Apple Watch Health Data&quot;,
         subtitle=&quot;what to write here&quot;,
         caption=&quot;Source: my retired Apple Watch (1st gen)&quot;,
         y=&quot;Complete 100%&quot;,
         color=NULL)
</code></pre>
<p><img class="img-zoomable" src="/image/apple-health-1.png" alt="" />
</p>
<p>But I&rsquo;m not satisfied with theme somehow, so I decide to experiment a little bit on a <a href="https://github.com/jrnold/ggthemes/blob/master/R/fivethirtyeight.R" target="_blank">FiveThirtyEight-style theme</a>. It is a more furnished theme, but does not match the Activity app palette. Well, I just cannot reject the magic of minimalism.</p>
<pre><code class="language-r">fte_theme &lt;- function() {

    # Generate the colors for the chart procedurally with RColorBrewer

    palette &lt;- brewer.pal(&quot;Greys&quot;, n=9)
    color.background = palette[2]
    color.grid.major = palette[3]
    color.axis.text = palette[6]
    color.axis.title = palette[7]
    color.title = palette[9]

    # Begin construction of chart

    theme_bw(base_size=9) +

        # Set the entire chart region to a light gray color

        theme(panel.background=element_rect(fill=color.background, color=color.background)) +
        theme(plot.background=element_rect(fill=color.background, color=color.background)) +
        theme(panel.border=element_rect(color=color.background)) +

        # Format the grid

        theme(panel.grid.major=element_line(color=color.grid.major,size=.25)) +
        theme(panel.grid.minor=element_blank()) +
        theme(axis.ticks=element_blank()) +

        # Format the legend, but hide by default

        theme(legend.position=&quot;none&quot;) +
        theme(legend.background = element_rect(fill=color.background)) +
        theme(legend.text = element_text(size=7,color=color.axis.title)) +

        # Set title and axis labels, and format these and tick marks

        theme(plot.title=element_text(color=color.title, size=10, vjust=1.25)) +
        theme(axis.text.x=element_text(size=7,color=color.axis.text)) +
        theme(axis.text.y=element_text(size=7,color=color.axis.text)) +
        theme(axis.title.x=element_text(size=8,color=color.axis.title, vjust=0)) +
        theme(axis.title.y=element_text(size=8,color=color.axis.title, vjust=1.25)) +

        # Plot margins

        theme(plot.margin = unit(c(0.35, 0.2, 0.3, 0.35), &quot;cm&quot;))
}
</code></pre>
<pre><code class="language-r">ggplot(full_data, aes(x=day, y=value)) +
    geom_line(aes(color=type),size=1) +
    fte_theme() +
    facet_grid(type ~ .) +
    labs(title=&quot;Apple Watch Health Data&quot;,
         subtitle=&quot;what to write here&quot;,
         caption=&quot;Source: my retired Apple Watch (1st gen)&quot;,
         y=&quot;Complete 100%&quot;,
         color=NULL)
</code></pre>
<p><img class="img-zoomable" src="/image/apple-health-2.png" alt="" />
</p>
<p>But even now I&rsquo;m not so sure about what I can really do with these data, except for probably plotting them with lines and dots. Meanwhile, I&rsquo;m not okay with the variable on y-axis as well. I tried to combine them in one plot at the very beginning, but it turned out that the three types of data were not on the same scale. So I made them the percentages of the completeness of daily goals by setting activity to 400, exercise time to 30 minutes and steps to 10,000. But still, the y-axis should better be &ldquo;the ratio to the goal&rdquo; instead of a bunch of misleading integers (1%? 2%?)</p>
<p>Well, at least I can conclude that all these match the title which says &ldquo;a sneak peek&rdquo;, not a thorough digging.</p>

    </div>
</article>


<div class="license markdown-body">
    <blockquote>
        <p>Unless otherwise noted, the content of this site is licensed under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"
               target="_blank">CC BY-NC-SA 4.0</a>.</p>
    </blockquote>
</div>


<div class="post-comment" data-comment="disqus">
    <span class="post-comment-notloaded">
        <i class="iconfont icon-chatbox-ellipses-sharp"></i>&nbsp;Load comments
    </span>
    <div id="disqus_thread" style="display: none;"></div>
    <script>
        function loadComment() {
            var commentArea = document.querySelector('.post-comment');
            var disqus_config = function () {
                this.page.url = '\/\/localhost:1313\/post\/2018-11-26-apple-watch-health-data\/';
                this.page.identifier = '2018-11-26-apple-watch-health-data';
            };
            var s = document.createElement('script');
            s.src = 'https://' + 'rexarski' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            document.querySelector('#disqus_thread').removeAttribute('style');
            (document.body || document.head).appendChild(s);
            document.querySelector('span.post-comment-notloaded').setAttribute('style', 'display: none;');
        }
    </script>
</div>


            </div>
            <aside class="col-12 col-md-3 float-left sidebar">
    
    <div class="sidebar-item sidebar-pages">
        <h3>Pages</h3>
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/now/">Now</a>
            </li>
            
            <li>
                <a href="/uses/">Uses</a>
            </li>
            
            <li>
                <a href="/archives/">Archives</a>
            </li>
            
            <li>
                <a href="/search/">Search</a>
            </li>
            
            <li>
                <a href="/index.xml">RSS</a>
            </li>
            
        </ul>
    </div>
    
    <div class="sidebar-item sidebar-tags">
        <h3>Tags</h3>
        <div>
            
            <span>
                <a href="/tags/algorithm/">Algorithm</a>
            </span>
            
            <span>
                <a href="/tags/aws/">AWS</a>
            </span>
            
            <span>
                <a href="/tags/cleaning/">Cleaning</a>
            </span>
            
            <span>
                <a href="/tags/conda/">conda</a>
            </span>
            
            <span>
                <a href="/tags/design/">Design</a>
            </span>
            
            <span>
                <a href="/tags/ec2/">EC2</a>
            </span>
            
            <span>
                <a href="/tags/food/">Food</a>
            </span>
            
            <span>
                <a href="/tags/generative/">Generative</a>
            </span>
            
            <span>
                <a href="/tags/ggplot2/">ggplot2</a>
            </span>
            
            <span>
                <a href="/tags/graph-theory/">Graph Theory</a>
            </span>
            
            <span>
                <a href="/tags/ios/">iOS</a>
            </span>
            
            <span>
                <a href="/tags/k-means/">k-means</a>
            </span>
            
            <span>
                <a href="/tags/linux/">Linux</a>
            </span>
            
            <span>
                <a href="/tags/macos/">macOS</a>
            </span>
            
            <span>
                <a href="/tags/maths/">Maths</a>
            </span>
            
            <span>
                <a href="/tags/mysql/">MySQL</a>
            </span>
            
            <span>
                <a href="/tags/productivity/">Productivity</a>
            </span>
            
            <span>
                <a href="/tags/r/">R</a>
            </span>
            
            <span>
                <a href="/tags/rmarkdown/">Rmarkdown</a>
            </span>
            
            <span>
                <a href="/tags/rss/">RSS</a>
            </span>
            
            <span>
                <a href="/tags/rstudio/">RStudio</a>
            </span>
            
            <span>
                <a href="/tags/scraping/">Scraping</a>
            </span>
            
            <span>
                <a href="/tags/self-host/">Self-host</a>
            </span>
            
            <span>
                <a href="/tags/shortcut/">Shortcut</a>
            </span>
            
            <span>
                <a href="/tags/telegram/">Telegram</a>
            </span>
            
            <span>
                <a href="/tags/visualization/">Visualization</a>
            </span>
            
        </div>
    </div>
    
    <div class="sidebar-item sidebar-links">
        <h3>Links</h3>
        <ul>
            
            <li>
                <a href="https://github.com/rexarski" target="_blank"><span>GitHub</span></a>
            </li>
            
            <li>
                <a href="https://twitter.com/rexarski" target="_blank"><span>Twitter</span></a>
            </li>
            
            <li>
                <a href="https://airavo.netlify.app" target="_blank"><span>Gallery</span></a>
            </li>
            
            <li>
                <a href="https://keybase.io/rexarski/chat" target="_blank"><span>Keybase</span></a>
            </li>
            
            <li>
                <a href="https://t.me/itsnopie" target="_blank"><span>Telegram</span></a>
            </li>
            
            <li>
                <a href="https://pinboard.in/u:rexarski" target="_blank"><span>Pinboard</span></a>
            </li>
            
        </ul>
    </div>
    
    
    
    
</aside>
        </div>
        <div class="btn">
    <div class="btn-toggle-mode">
        <i class="iconfont icon-contrast-sharp"></i>
    </div>
    <div class="btn-scroll-top">
        <i class="iconfont icon-chevron-up-circle-sharp"></i>
    </div>
</div>
    </main>

    <footer>
    <div class="container-lg clearfix">
        <div class="col-12 footer">
            <span>&copy; 2020 <a href="//localhost:1313/">Qiū Ruì</a> |
                Powered by <a href="https://github.com/amzrk2/hugo-theme-fuji/"
                   target="_blank">Fuji-v2</a> & <a href="https://gohugo.io/"
                   target="_blank">Hugo</a> </span>
        </div>
    </div>
</footer>
    
<script defer src="https://cdn.jsdelivr.net/combine/npm/medium-zoom@1.0.5,npm/lazysizes@5.2.2"></script>
<script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.20.0/components/prism-core.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.20.0/plugins/autoloader/prism-autoloader.min.js"></script>

<script defer src="/assets/js/fuji.min.js"></script>


</body>

</html>